<div class="wrapper">
  <div class="d-flex align-items-center" *ngIf="!!message?.fakeData">
    <button class="play-btn position-relative"
            [ngClass]="{'incoming' : !message?.is_sender , 'outgoing' : message?.is_sender}"
            (click)="onPlayBtn()">
      <div class="infinite-rotate" style="margin: -4px;">
        <round-progress
          [current]="message?.fakeData?.uploadRatio ?? 0"
          [max]="1"
          [color]="'white'"
          [background]="'transparent'"
          [radius]="125"
          [stroke]="20"
          [semicircle]="false"
          [rounded]="true"
          [clockwise]="true"
          [responsive]="true"
          [duration]="800"
          [animation]="'easeInOutQuart'"
          [animationDelay]="0"
          (onRender)="onRender($event)"></round-progress>
      </div>

      <div class="upload-percent">
        {{((message?.fakeData?.uploadRatio ?? 0) * 100).noFractionDigit()}}<span style="font-size: 0.5rem"> %</span>
      </div>
    </button>
  </div>

  <div class="d-flex align-items-center" *ngIf="message?.media_id">
    <audio class="d-none" [attr.src]="getMediaSrc() | secure | async" controls #audio
           (loadedmetadata)="loadedmetadata($event)">
    </audio>
    <button class="play-btn" [ngClass]="{'incoming' : !message?.is_sender , 'outgoing' : message?.is_sender}"
            (click)="onPlayBtn()">
      <ng-container *ngIf="!isLoaded">
        <fa-icon class="d-flex justify-content-center align-items-center" [icon]="faSpinner"/>
      </ng-container>

      <ng-container *ngIf="isLoaded">
        <fa-icon class="justify-content-center align-items-center" [icon]="faPlay" *ngIf="!isVoicePlaying"/>
        <fa-icon class="justify-content-center align-items-center" [icon]="faPause" *ngIf="isVoicePlaying"/>
      </ng-container>
    </button>
    <div class="flex-grow-1 ms-2 slider-wrapper">
      <input class="slider w-100" type="range" id="seek-slider" [step]="0.01" [min]="0" [max]="audio.duration"
             (touchstart)="touchstart($event)" (touchcancel)="touchcancel($event)" (touchend)="touchend($event)"
             (change)="onSliderChange($event)"
             [ngClass]="{'incoming' : !message?.is_sender , 'outgoing' : message?.is_sender}"
             value="0" #inputRange>
      <div class="time-wrapper d-flex justify-content-between">
        <div class="fw-bold" #audioTimeCounter>{{calculateTime(0)}}</div>
        <div class="fw-bold">{{fileData?.duration ?? audioDuration}}</div>
      </div>
    </div>
  </div>
  <span class="d-inline-block" [ngStyle]="{'width': 'calc(100% - ' + 0 + 'px - 1px)'}"
        style="text-align: right">
        <app-message-status-wrapper [message]="message" [conversation]="conversation"></app-message-status-wrapper>
  </span>
</div>

